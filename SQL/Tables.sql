DROP TABLE REQUEST;

CREATE TABLE REQUEST
(
	ID NUMBER,
	USERNAME VARCHAR2(20),
	BLOOD_GROUP VARCHAR2(4),
	LOCATION VARCHAR2(20),
	LOCATION_DETAILS VARCHAR(250),
	COMPLICATIONS VARCHAR2(50),
	QUANTITY NUMBER,
	APPROX_DATE DATE,
	PATIENT VARCHAR2(50),
	P_GENDER VARCHAR2(10),
	EM_MOBILE VARCHAR2(12),
	CONSTRAINT REQUEST_PK PRIMARY KEY (ID, USERNAME)
);

DROP SEQUENCE REQUEST_SEQUENCE;
CREATE SEQUENCE REQUEST_SEQUENCE;

CREATE OR REPLACE TRIGGER REQUEST_ON_INSERT
BEFORE INSERT ON REQUEST
FOR EACH ROW
BEGIN
SELECT REQUEST_SEQUENCE.NEXTVAL
INTO :NEW.ID
FROM DUAL;
END;
/


CREATE TABLE LOCATIONS
(
	NAME VARCHAR2(20) PRIMARY KEY
);

INSERT INTO LOCATIONS VALUES ('MIRPUR');
INSERT INTO LOCATIONS VALUES ('UTTARA');
INSERT INTO LOCATIONS VALUES ('BANANI');
INSERT INTO LOCATIONS VALUES ('GULSHAN');
INSERT INTO LOCATIONS VALUES ('DHANMONDI');
INSERT INTO LOCATIONS VALUES ('BARIDHARA');
INSERT INTO LOCATIONS VALUES ('MOGBAZAR');
INSERT INTO LOCATIONS VALUES ('KAMLAPUR');
INSERT INTO LOCATIONS VALUES ('MOTIJHEEL');
INSERT INTO LOCATIONS VALUES ('FARMGATE');
INSERT INTO LOCATIONS VALUES ('SHAHABAG');
INSERT INTO LOCATIONS VALUES ('NEW MARKET');
INSERT INTO LOCATIONS VALUES ('AZIMPUR');
INSERT INTO LOCATIONS VALUES ('MOHAMMADPUR');
INSERT INTO LOCATIONS VALUES ('GULISTAN');
INSERT INTO LOCATIONS VALUES ('JATRABARI');

CREATE TABLE REGISTRATION
(
    USERNAME VARCHAR2(20) PRIMARY KEY,
    PASSWORD VARCHAR2(20),
    USER_TYPE VARCHAR2(15)
);

CREATE TABLE PERSONAL_INFO
(
    USERNAME VARCHAR2(20) PRIMARY KEY,
    NAME VARCHAR2(50),
    MOBILE VARCHAR2(12),
    EMAIL VARCHAR2(50),
    DOB DATE,
    LOCATION VARCHAR2(15),
    GENDER VARCHAR2(10),
    BLOOD_GROUP VARCHAR2(4)
);

CREATE TABLE ORG_INFO
(
    USERNAME VARCHAR2(20) PRIMARY KEY,
    NAME VARCHAR2(100),
    CONTACT VARCHAR2(12),
    EMAIL VARCHAR2(50),
    LOCATION VARCHAR2(15),
    LIC_NO VARCHAR2(50),
    CONTACT_PERSON VARCHAR2(50),
    CP_MOBILE VARCHAR2(12),
    DESCRIPTION VARCHAR2(250)
);

/*
SELECT * FROM REGISTRATION;
SELECT * FROM PERSONAL_INFO;
SELECT * FROM ORG_INFO;
*/

CREATE OR REPLACE FUNCTION findDeleteReqID(name_in IN varchar2, rnum_in IN number)
RETURN NUMBER
IS
    REQ_ID NUMBER;

BEGIN
    SELECT ID
    INTO REQ_ID
    FROM (SELECT ID, ROWNUM AS RN FROM REQUEST WHERE USERNAME=name_in) WHERE RN=rnum_in;

    RETURN REQ_ID;
END;
/

CREATE TABLE DONOR_INFO
(
    USERNAME VARCHAR2(20) PRIMARY KEY,
    ELIGIBILITY VARCHAR2(12) DEFAULT 'Ineligible',
    ACTIVENESS VARCHAR2(10) DEFAULT 'Inactive',
    PAYABLE VARCHAR2(9) DEFAULT 'NON-Paid'
);

---INSERT INTO DONOR_INFO (USERNAME) SELECT USERNAME FROM PERSONAL_INFO;

CREATE TABLE DONATION_INFO
(
    USERNAME VARCHAR2(20),
    LOCATION VARCHAR2(15),
    P_NAME VARCHAR2(100),
    P_GENDER VARCHAR2(10),
    COMPLICATIONS VARCHAR2(50),
    P_CONTACT VARCHAR2(12),
    D_DATE DATE,
    LOCATION_DETAILS VARCHAR2(250),
    PRIMARY KEY (USERNAME, D_DATE)
);